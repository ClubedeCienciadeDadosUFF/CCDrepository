<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
    <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
  	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/map.css">
  	<script type="text/javascript" src="js/leafletembed.js"></script>
  	<script src="js/data.js"></script>
  	<link href="css/simple-sidebar.css" rel="stylesheet">
  	<link href="css/button.css" rel="stylesheet">
  	<link rel="stylesheet" href="css/leaflet.awesome-markers.css">
  	<script src="js/leaflet.awesome-markers.js"></script>
  	<link rel="stylesheet" href="font-awesome/css/font-awesome.min.css">
  	<link rel="stylesheet" href="http://code.ionicframework.com/ionicons/1.5.2/css/ionicons.min.css">
  	<link rel="stylesheet" href="css/build.css"> <!-- This is the checkbox and RadioButton -->
    <title> SIAC </title>
  </head>
  <body>
  	
  	<div id="wrapper">      

  		<!-- /#sidebar-wrapper -->
  		<div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="#">
                        SIAC
                    </a>
                </li>
                <li>
				    <a href="#" onclick="onClickOcorrencias()">
				    	Marcar Ocorrências
				    </a>
                    <!--<a id="importData" href="#">Importar dados</a> -->
                </li>
                <li>
                	<a href="#" onclick="onClickInducoes()">
                		Marcar Induções
                	</a>
                </li>
            </ul>
        </div>
        <!-- /#sidebar-wrapper -->

        <!-- map-wrapper -->
	    <div id="map-wrapper">
	      <div id="map" class="leaf-container"> </div>
	    </div>
	    <!-- /#map-wrapper -->

	</div>

    <script>

    /*Markers type */
    var rouboMarker = L.AwesomeMarkers.icon({
    icon: 'user',
    prefix: 'fa',
    markerColor: 'red'
  	});
  	var furtoMarker = L.AwesomeMarkers.icon({
    icon: 'user',
    prefix: 'fa',
    markerColor: 'blue'
  	});
  	var rouboDeVeiculoMarker = L.AwesomeMarkers.icon({
    icon: 'user',
    prefix: 'fa',
    markerColor: 'green'
  	});
  	var assaltoAGrupoMarker = L.AwesomeMarkers.icon({
    icon: 'user',
    prefix: 'fa',
    markerColor: 'black'
  	});
  	var tentativaDeAssaltoMarker = L.AwesomeMarkers.icon({
    icon: 'user',
    prefix: 'fa',
    markerColor: 'orange'
  	});
  	var sequestroRelampagoMarker = L.AwesomeMarkers.icon({
    icon: 'user',
    prefix: 'fa',
    markerColor: 'purple'
  	});
  	var arrombamentoVeicularMarker = L.AwesomeMarkers.icon({
    icon: 'user',
    prefix: 'fa',
    markerColor: 'cadetblue'
  	});
  	var arrombamentoDomiciliarMarker = L.AwesomeMarkers.icon({
    icon: 'user',
    prefix: 'fa',
    markerColor: 'darkred'
  	});
  	var arrastaoMarker = L.AwesomeMarkers.icon({
    icon: 'user',
    prefix: 'fa',
    markerColor: 'darkgreen'
  	});

  	/* variables */
  	var occurrencesData;
  	var occurrences = [];
  	var occurrencesGroupLayer = null;

  	var inductionsData;
  	var inductions = [];
  	var inductionsGroupLayer = null;

  	var legend = L.control({position: 'bottomright'});

  	legend.onAdd = function (map) 
  	{

    var div = L.DomUtil.create('div', 'info legend')

    // loop through our density intervals and generate a label with a colored square for each interval
    //for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
            '<i style="background:' + '#ea4e39' + '"></i> ' +
            'Roubo' + '<br>';
            //'grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+'');
    //}

	    return div;
	};

	$(document).ready(function()
	{
		initmap();
		occurrencesData = JSON.parse(rawOccurrencesData);
		prepareOccurrencesData(occurrencesData);
		inductionsData = JSON.parse(rawInductionsData)
		prepareInductionsData(inductionsData);
		legend.addTo(map);
	});

	function prepareOccurrencesData(occurrencesData)
	{
		for (var i = 0; i < occurrencesData.length; i++) 
		{
			var marker = insertMarker(occurrencesData[i]);
			insertPopUp(marker, occurrencesData[i]);
		};
		occurrencesGroupLayer = L.layerGroup(occurrences);
	}
	function insertMarker(rowData)
	{
		var marker = null;
		if(rowData.occurrence_type.toLowerCase().localeCompare("roubo") == 0)
				marker = L.marker([rowData.latitude, rowData.longitude], {icon: rouboMarker});
		else if(rowData.occurrence_type.toLowerCase().localeCompare("furto") == 0)
			marker = L.marker([rowData.latitude, rowData.longitude], {icon: furtoMarker});
		else if(rowData.occurrence_type.toLowerCase().localeCompare("roubo_de_veiculo") == 0)
			marker = L.marker([rowData.latitude, rowData.longitude], {icon: rouboDeVeiculoMarker});
		else if(rowData.occurrence_type.toLowerCase().localeCompare("assalto_a_grupo") == 0) 
			marker = L.marker([rowData.latitude, rowData.longitude], {icon: assaltoAGrupoMarker});
		else if(rowData.occurrence_type.toLowerCase().localeCompare("arrastao") == 0)
			marker = L.marker([rowData.latitude, rowData.longitude], {icon: arrastaoMarker});
		else if(rowData.occurrence_type.toLowerCase().localeCompare("arrombamento_domiciliar") == 0)
			marker = L.marker([rowData.latitude, rowData.longitude], {icon: arrombamentoDomiciliarMarker});
		else if(rowData.occurrence_type.toLowerCase().localeCompare("arrombamento_veicular") == 0)
			marker = L.marker([rowData.latitude, rowData.longitude], {icon: arrombamentoVeicularMarker});
		else if(rowData.occurrence_type.toLowerCase().localeCompare("tentativa_de_assalto") == 0)
			marker = L.marker([rowData.latitude, rowData.longitude], {icon: tentativaDeAssaltoMarker});
		else if(rowData.occurrence_type.toLowerCase().localeCompare("sequestro_relampago") == 0)
			marker = L.marker([rowData.latitude, rowData.longitude], {icon: sequestroRelampagoMarker});
		return marker;
	}
	function insertPopUp(marker, rowData)
	{
		if(marker != null)
		{
			var occurrence_type = rowData.occurrence_type.toLowerCase();
			var normalizedString = occurrence_type.split('_').join(' ');
			normalizedString = firstToUpperCase(normalizedString);
			var objects = "";
			$.each(rowData, function(k, v) 
			{
				value = v.toString();
				value = value.toLowerCase();
			    if(value.localeCompare("true") == 0)
			    	objects +=  firstToUpperCase(k.split('_').join(' ')) + ", ";
			});
			objects = objects.replace(/,\s*$/, "");
			marker.bindPopup("<b>" + normalizedString + "</b>" + "<br><b>" + "Objetos roubados : " + "</b>" + objects + "." + "<br><b>" + "Hora : " + "</b>" + rowData.time);
			occurrences.push(marker);
		}
	}
	function firstToUpperCase( str ) 
	{
    	return str.substr(0, 1).toUpperCase() + str.substr(1);
	}
	function prepareInductionsData(inductionsData)
	{
		console.log(inductionsData.rules)
	}
	function onClickInducoes()
    {
    	map.removeLayer(occurrencesGroupLayer);
    	alert('Ainda não implementado')
    }
	function onClickOcorrencias()
    {
    	plotData();
    }
	function plotData()
	{
		occurrencesGroupLayer.addTo(map);
	}
    </script>
  </body>
<html>

